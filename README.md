# Менеджер паролей GophKeeper

[![License](https://img.shields.io/badge/license-MIT-blue)](LICENSE)

- [Общая информация](#общая-информация)
- [Архитектура](#архитектура)
    - [Функциональная схема](#функциональная-схема)
    - [Сущности приложения](#сущности-приложения)
    - [Диаграмма последовательности](#диаграмма-последовательности)
    - [Схема базы данных](#схема-базы-данных)
- [Особенности реализации](#особенности-реализации)
    - [Конфигурация](#конфигурация)
    - [Терминальный интерфейс клиента](#терминальный-интерфейс-клиента)
    - [Использованные библиотеки](#использованные-библиотеки)
- [Итоги](#итоги)
    - [Освоенные темы](#освоенные-темы)
    - [Возможное развитие проекта](#возможное-развитие-проекта)

## Общая информация
[Техническое задание](docs/SPECIFICATION.md)

Клиент-серверная система хранения приватных данных «GophKeeper» (второй выпускной проект курса «Продвинутый Go-разработчик»). Обеспечивает безопасное хранение и передачу следующих данных пользователя:
- [ ] пара логин/пароль
- [ ] данные банковских карт
- [ ] произвольные текстовые данные
- [ ] произвольные бинарные данные (файлы до 1 МБ)

Также для всех типов данных есть возможность хранения произвольной текстовой метаинформации (принадлежность данных к веб-сайту, личности или банку, списки одноразовых кодов активации и прочее).

Клиент и сервер обмениваются данными с помощью gRPC.

Клиент представляет собой CLI-приложение (с терминальным интерфейсом) с возможностью запуска на платформах Windows, Linux и Mac OS. Реализует следующий функционал:
- [x] регистрация нового пользователя
- [x] аутентификация существующего пользователя
- [ ] шифрование/расшифровка приватных данных пользователя
- [ ] создание/удаление/обновление приватных данных пользователя

Сервер обслуживает запросы от клиентской программы и реализует следующую логику:
- [x] обслуживание запроса на регистрацию
- [x] аутентификация пользователя
- [ ] обслуживание запросов на создание/обновление/удаление приватных данных пользователя
- [x] работа с базой данных

Пароли пользователей храняться в БД в зашифрованном виде (для шифрования используется bcrypt).

Для аутентификации запросов пользователя, используются токены PaseTo. Токен генерируется при регистрации/аутентификации пользователя и отправляется со всеми командами (кроме register/login).

## Архитектура
### Функциональная схема
![Функциональная схема](docs/functional_scheme.png)

### Сущности приложения
![Сущности приложения](docs/entities.png)

### Диаграмма последовательности
Представлена на примере маршрута первичной регистрации пользователя.
![Диаграмма последовательности](docs/register_seq.png)

### Схема базы данных
В качестве базы данных используется PostgreSQL.

![Схема базы данных](docs/db_scheme.png)

## Особенности реализации
### Конфигурация
Клиентское и серверное приложения конфигурируются переменными окружения и данными из файла конфигурации (путь к которому задаётся флагом `-c` при запуске). Приоритет отдаётся переменным окружения.
Если параметр не задан ни в одном из вариантов, то при запуске будет выдана ошибка и приложение завершится с кодом `1`.

**Клиент**

| Переменная окружения | Параметры из файла | Описание                              |
|----------------------|--------------------|---------------------------------------|
| `APP_NAME`           | `app.name`         | название приложения                   |
| `APP_VERSION`        | `app.version`      | версия приложения                     |
| `GRPC_ADDRESS`       | `grpc.address`     | адрес gRPC-сервера                    |
| `GRPC_PORT`          | `grpc.port`        | порт gRPC-сервера для отправки команд |

**Сервер**

| Переменная окружения    | Параметры из файла       | Описание                                     |
|-------------------------|--------------------------|----------------------------------------------|
| `APP_NAME`              | `app.name`               | название приложения                          |
| `APP_VERSION`           | `app.version`            | версия приложения                            |
| `PG_URL`                | *нет*                    | адрес подключения к базе данных              |
| `PG_POOL_MAX`           | `postgres.pool_max`      | максимальное количество подключений к БД     |
| `PG_CONN_ATTEMPTS`      | `postgres.conn_attempts` | количество попыток подключения к БД          |
| `GRPC_PORT`             | `grpc.port`              | порт приёма команд и отправки данных по gRPC |
| `TOKEN_KEY`             | *нет*                    | ключ для подписи токена                      |
| `TOKEN_ACCESS_DURATION` | `token.access_duration`  | длительность действия токена                 |

### Терминальный интерфейс клиента
После успешного запуска клиента в терминале появляется основное меню (main), из которого можно зарегистрировать нового пользователя либо зайти с имеющимся логином/паролем.

После успешного входа (получение токена от сервера) отображается меню с типами данных (units), хранящихся на сервере. Из него можно перейти к просмотру необходимых списков.

Также в нижней части слева отображается название и версия приложения клиента. А после подключения к серверу - справа отобразится аналогичная информация для него.

Навигация по меню осуществляется стрелками `вверх/вниз`, выбор пункта - клавиша `Enter`. Также слева от пунктов имеются указания кнопок быстрого доступа - нажатие соответствующей кнопки приведёт к немедленному переходу к выбранному экрану/меню.

![Терминальный интерфейс клиента](docs/client_tui.png)

### Использованные библиотеки
- Конфигурация: [ilyakaznacheev/cleanenv](https://github.com/ilyakaznacheev/cleanenv)
- Логгирование: обёртка над [uber-go/zap](https://github.com/uber-go/zap)
- Работа с БД: драйвер [jackc/pgx](https://github.com/jackc/pgx), библиотека [jmoiron/sqlx](https://github.com/jmoiron/sqlx)
- Авторизация: [o1egl/paseto](https://github.com/o1egl/paseto)
- Тестирование: [stretchr/testify](https://github.com/stretchr/testify)

## Итоги
### Освоенные темы

<mark>**_В проработке_**

| Тема                                 | Затраченное время | Результат | Примечание |
|--------------------------------------|-------------------|-----------|------------|
| Аналитика ТЗ                         |                   |           |            |
| SQL / Postgres                       |                   |           |            |
| Язык Go                              |                   |           |            |
| Новые библиотеки                     |                   |           |            |
| Обработка ошибок                     |                   |           |            |
| Архитектура и организация приложения |                   |           |            |
| Code- style и выразительность        |                   |           |            |
| Тестирование                         |                   |           |            |
| DI                                   |                   |           |            |

### Возможное развитие проекта

- Шифрование пользовательских данных с помощью мастер ключа, который хранится только на клиенте.
- Подгрузка на клиентское приложение только изменившихся данных (например, путём проверки md5-хеша из базы)
- Хранение токена и логин без ввода пароля, если токен валиден
- Больше информативности в TUI (ошибки от сервера и клиента)
